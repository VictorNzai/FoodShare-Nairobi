<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Charity Request Details - FoodShare</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;700;800&family=Noto+Sans:wght@400;500;700;900&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Manrope", "Noto Sans", sans-serif;
      }
      .sidebar-link.active,
      .sidebar-link:hover {
        background: #eaf3e7;
        color: #54d12b;
        font-weight: 700;
      }
    </style>
  </head>
  <body class="bg-[#f9fcf8] text-[#111b0e]">
    <div class="flex min-h-screen">
      <!-- Sidebar -->
      <aside
        class="hidden lg:flex flex-col w-64 bg-white border-r border-[#eaf3e7] py-8 px-6 sticky top-0 h-screen z-10"
      >
        <div class="mb-10 flex items-center gap-2">
          <span class="font-extrabold text-2xl text-[#54d12b]">üç¥</span>
          <span class="font-extrabold text-xl text-[#54d12b]">FoodShare</span>
        </div>
        <nav class="flex flex-col gap-2 text-base">
          <a
            href="FoodDonor.html"
            class="sidebar-link px-4 py-2 rounded-full font-medium"
            >Dashboard</a
          >
          <a href="#" class="sidebar-link px-4 py-2 rounded-full font-medium"
            >Donations</a
          >
          <a href="#" class="sidebar-link px-4 py-2 rounded-full font-medium"
            >Charities</a
          >
          <a
            href="CharityRequestsPage.html"
            class="sidebar-link px-4 py-2 rounded-full font-medium"
            >Charity Requests</a
          >
          <a href="#" class="sidebar-link px-4 py-2 rounded-full font-medium"
            >Account</a
          >
          <a href="#" class="sidebar-link px-4 py-2 rounded-full font-medium"
            >Help</a
          >
          <button
            id="logoutBtn"
            class="sidebar-link px-4 py-2 rounded-full font-medium text-left mt-8"
          >
            Logout
          </button>
        </nav>
        <div class="mt-auto flex items-center gap-3 pt-10">
          <div
            class="w-10 h-10 bg-cover bg-center rounded-full border border-[#eaf3e7]"
            id="donor-avatar"
            style="
              background-image: url('https://ui-avatars.com/api/?name=Donor');
            "
          ></div>
          <span class="font-semibold text-[#121a0f]" id="sidebar-donor-name"
            >Donor</span
          >
        </div>
      </aside>
      <!-- Main Content -->
      <main class="flex-1">
        <section class="p-6 max-w-2xl mx-auto">
          <button
            onclick="window.history.back()"
            class="mb-6 text-[#54d12b] hover:underline font-medium"
          >
            &larr; Back to Requests
          </button>
          <div
            id="request-details"
            class="bg-white border border-[#d5e7d0] rounded-2xl shadow p-8 flex flex-col gap-4"
          ></div>
        </section>
      </main>
    </div>
    <script>
      // Set donor name/avatar
      const donorName = localStorage.getItem("donorName") || "Donor";
      document.getElementById("sidebar-donor-name").textContent = donorName;
      document.getElementById(
        "donor-avatar"
      ).style.backgroundImage = `url('https://ui-avatars.com/api/?name=${encodeURIComponent(
        donorName
      )}')`;
      document.getElementById("logoutBtn").onclick = () => {
        localStorage.clear();
        window.location.href = "../Login.html";
      };
      // Get request ID from URL
      function getRequestId() {
        const params = new URLSearchParams(window.location.search);
        return params.get("id");
      }
      // Fetch and render request details
      function fetchRequestDetails() {
        const id = getRequestId();
        const detailsDiv = document.getElementById("request-details");
        if (!id) {
          detailsDiv.innerHTML =
            '<div class="text-red-500">Invalid request ID.</div>';
          return;
        }
        detailsDiv.innerHTML =
          '<div class="text-gray-500">Loading details...</div>';
        fetch(`http://localhost:3000/api/charity-requests/${id}`)
          .then((res) => res.json())
          .then((data) => {
            if (!data.success || !data.request) {
              detailsDiv.innerHTML =
                '<div class="text-red-500">Request not found.</div>';
              return;
            }
            const req = data.request;
            detailsDiv.innerHTML = `
            <div class="flex items-center gap-3 mb-2">
              <span class="inline-block bg-[#eaf3e7] text-[#54d12b] font-bold px-3 py-1 rounded-full text-xs">${
                req.org_name
              }</span>
              <span class="ml-auto text-xs text-gray-400">${
                req.date ? new Date(req.date).toLocaleDateString() : ""
              }</span>
            </div>
            <div class="font-bold text-2xl text-[#121a0f] mb-1">${
              req.food_item
            }</div>
            <div class="text-base text-gray-700 mb-1">Quantity: <span class="font-semibold">${
              req.quantity
            }</span></div>
            <div class="text-base text-gray-700 mb-1">Pickup Location: <span class="font-semibold">${
              req.pickup_location
            }</span></div>
            <div class="text-base text-gray-700 mb-2">${
              req.notes
                ? `<span class='font-medium'>Notes:</span> ${req.notes}`
                : ""
            }</div>
            <div class="flex gap-4 mt-4">
              <button class="bg-[#53d22c] hover:bg-[#43b81a] text-white px-6 py-2 rounded-full text-base font-bold" onclick="alert('Pledge to fulfill coming soon!')">Pledge to Fulfill</button>
            </div>
          `;
          })
          .catch(() => {
            detailsDiv.innerHTML =
              '<div class="text-red-500">Failed to load details.</div>';
          });
      }
      fetchRequestDetails();
    </script>
  </body>
</html>
