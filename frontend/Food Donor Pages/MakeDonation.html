<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Make a Food Donation | FoodShare</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;700;800&family=Noto+Sans:wght@400;500;700;900&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Manrope", "Noto Sans", sans-serif;
      }
    </style>
  </head>
  <body class="bg-[#f9fcf8] text-[#111b0e] min-h-screen flex flex-col">
    <main class="flex-1 flex flex-col items-center justify-center p-6">
      <div
        class="w-full max-w-lg bg-white rounded-xl shadow p-8 border border-[#eaf3e7]"
      >
        <h2 class="text-2xl font-bold mb-6 text-[#54d12b]">
          Make a Food Donation
        </h2>
        <form id="donationForm" class="space-y-4">
          <div>
            <label for="category" class="block font-medium mb-1"
              >Food Category</label
            >
            <select
              id="category"
              name="category"
              required
              class="w-full border rounded px-3 py-2"
            >
              <option value="">Select a category</option>
              <option value="Cereals">Cereals</option>
              <option value="Vegetables">Vegetables</option>
              <option value="Fruits">Fruits</option>
              <option value="Dairy">Dairy</option>
              <option value="Baked Goods">Baked Goods</option>
              <option value="Canned Foods">Canned Foods</option>
              <option value="Meat & Poultry">Meat & Poultry</option>
              <option value="Other">Other</option>
            </select>
          </div>
          <div>
            <label for="description" class="block font-medium mb-1"
              >Food Description</label
            >
            <input
              type="text"
              id="description"
              name="description"
              required
              class="w-full border rounded px-3 py-2"
              placeholder="e.g. Brown rice, 2 loaves of bread"
            />
          </div>
          <div class="flex gap-2">
            <div class="flex-1">
              <label for="quantity" class="block font-medium mb-1"
                >Quantity</label
              >
              <input
                type="number"
                id="quantity"
                name="quantity"
                min="1"
                required
                class="w-full border rounded px-3 py-2"
                placeholder="e.g. 5"
              />
            </div>
            <div class="w-32">
              <label for="unit" class="block font-medium mb-1">Unit</label>
              <select
                id="unit"
                name="unit"
                required
                class="w-full border rounded px-3 py-2"
              >
                <option value="kg">kg</option>
                <option value="g">g</option>
                <option value="liters">liters</option>
                <option value="pieces">pieces</option>
                <option value="packs">packs</option>
                <option value="other">other</option>
              </select>
            </div>
          </div>
          <div>
            <label for="expiry" class="block font-medium mb-1"
              >Expiry Date</label
            >
            <input
              type="date"
              id="expiry"
              name="expiry"
              required
              class="w-full border rounded px-3 py-2"
            />
          </div>
          <div>
            <label for="pickup_address" class="block font-medium mb-1"
              >Pickup Address</label
            >
            <input
              type="text"
              id="pickup_address"
              name="pickup_address"
              required
              class="w-full border rounded px-3 py-2"
              placeholder="e.g. 123 Main St, Nairobi"
            />
          </div>
          <div>
            <label for="notes" class="block font-medium mb-1"
              >Additional Notes (optional)</label
            >
            <textarea
              id="notes"
              name="notes"
              class="w-full border rounded px-3 py-2"
              rows="2"
              placeholder="Any special instructions..."
            ></textarea>
          </div>
          <button
            type="submit"
            class="w-full bg-[#53d22c] hover:bg-[#43b81a] text-white font-bold py-2 rounded-full mt-4"
          >
            Submit Donation
          </button>
        </form>
        <div id="form-message" class="mt-4 text-center text-sm"></div>
        <div class="mt-6 text-center">
          <a href="./FoodDonor.html" class="text-[#54d12b] hover:underline"
            >&larr; Back to Dashboard</a
          >
        </div>
      </div>
    </main>
    <script>
      document.getElementById("donationForm").onsubmit = async function (e) {
        e.preventDefault();
        const donor = JSON.parse(localStorage.getItem("donor") || "{}");
        if (!donor.id) {
          document.getElementById("form-message").textContent =
            "You must be logged in as a donor to submit a donation.";
          return;
        }
        const data = {
          donor_id: donor.id,
          category: this.category.value,
          description: this.description.value,
          quantity: this.quantity.value,
          unit: this.unit.value,
          expiry: this.expiry.value,
          pickup_address: this.pickup_address.value,
          notes: this.notes.value,
        };
        const res = await fetch("/api/donations", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data),
        });
        const msg = document.getElementById("form-message");
        if (res.ok) {
          msg.textContent = "Donation submitted successfully!";
          msg.className = "mt-4 text-center text-green-600";
          this.reset();
        } else {
          const err = await res.json();
          msg.textContent = err.message || "Failed to submit donation.";
          msg.className = "mt-4 text-center text-red-600";
        }
      };
    </script>
  </body>
</html>
