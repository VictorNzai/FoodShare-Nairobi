<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Charity Profile - FoodShare</title>
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;700;800&family=Noto+Sans:wght@400;500;700;900&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        margin: 0;
        font-family: "Manrope", "Noto Sans", Arial, sans-serif;
        background: #f9fcf8;
        color: #111b0e;
      }
      header {
        background: white;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px 40px;
        border-bottom: 1px solid #ddd;
        position: relative;
        z-index: 2;
      }
      .logo {
        font-weight: bold;
        font-size: 18px;
        color: #54d12b;
      }
      nav a {
        margin-left: 30px;
        text-decoration: none;
        color: #333;
        font-size: 14px;
        font-weight: 500;
      }
      .sign-up-btn {
        background-color: #54d12b;
        color: white;
        padding: 8px 18px;
        border: none;
        border-radius: 20px;
        font-weight: bold;
        cursor: pointer;
        margin-left: 30px;
      }
      .flex {
        display: flex;
        min-height: 100vh;
      }
      /* Sidebar */
      .sidebar {
        width: 250px;
        padding: 32px 24px;
        border-right: 1px solid #eaf3e7;
        background: #fff;
        display: none;
        position: fixed;
        top: 70px;
        left: 0;
        height: calc(100vh - 70px);
        z-index: 1;
      }
      @media (min-width: 1024px) {
        .sidebar {
          display: block;
        }
      }
      .sidebar .logo {
        font-size: 20px;
        font-weight: 700;
        margin-bottom: 32px;
        color: #54d12b;
      }
      .sidebar nav {
        display: flex;
        flex-direction: column;
        gap: 12px;
      }
      .sidebar nav a {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px 20px;
        border-radius: 999px;
        background: none;
        color: #222;
        font-size: 15px;
        font-weight: 500;
        text-decoration: none;
        transition: background 0.2s, color 0.2s;
      }
      .sidebar nav a.active,
      .sidebar nav a:hover {
        background: #eaf3e7;
        color: #54d12b;
        font-weight: 700;
      }
      /* Main Content */
      .main-content {
        flex: 1;
        padding: 0;
        max-width: 100vw;
        margin: 0;
        margin-left: 320px;
        margin-top: 70px;
      }
      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: none;
        border-radius: 0;
        box-shadow: none;
        padding: 0;
        width: 100%;
      }
      h2 {
        color: #54d12b;
        margin-bottom: 30px;
        text-align: center;
      }
      .info {
        margin-bottom: 24px;
      }
      .verified {
        color: #54d12b;
        font-weight: bold;
      }
      .not-verified {
        color: #e67e22;
        font-weight: bold;
      }
      label {
        display: block;
        margin-bottom: 8px;
        color: #333;
        font-weight: bold;
      }
      input,
      textarea {
        width: 100%;
        padding: 10px;
        margin-bottom: 22px;
        border: 1px solid #ccc;
        border-radius: 5px;
        font-size: 15px;
        box-sizing: border-box;
      }
      .submit-btn {
        background: #54d12b;
        color: #fff;
        border: none;
        border-radius: 20px;
        padding: 12px 0;
        width: 100%;
        font-size: 16px;
        font-weight: bold;
        cursor: pointer;
        transition: background 0.2s;
      }
      .submit-btn:hover {
        background: #43a81a;
      }
      .back-link {
        display: block;
        text-align: center;
        margin-top: 18px;
        color: #54d12b;
        text-decoration: none;
        font-size: 15px;
      }
      .back-link:hover {
        text-decoration: underline;
      }
      /* Profile Styles */
      .profile-header {
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        padding: 32px 0 16px 0;
        border-bottom: 1px solid #eaf3e7;
        background: #fff;
        border-radius: 18px 18px 0 0;
        position: relative;
        width: 100%;
        min-width: 600px;
        min-height: 260px;
      }
      .profile-banner {
        width: 100%;
        height: 220px;
        background: linear-gradient(90deg, #54d12b 0%, #a8e063 100%);
        border-radius: 18px 18px 0 0;
        position: absolute;
        top: 0;
        left: 0;
        z-index: 0;
      }
      .profile-avatar {
        width: 160px;
        height: 160px;
        border-radius: 50%;
        border: 4px solid #fff;
        object-fit: cover;
        position: relative;
        top: 120px;
        left: 64px;
        background: #eee;
        z-index: 1;
      }
      .profile-info {
        margin-top: 110px;
        margin-left: 64px;
        z-index: 2;
        position: relative;
      }
      .profile-info h2 {
        margin: 0 0 6px 0;
        font-size: 38px;
        font-weight: 800;
        color: #222;
      }
      .profile-info .verified {
        font-size: 15px;
        margin-left: 8px;
        color: #54d12b;
        font-weight: 700;
      }
      .profile-info .not-verified {
        font-size: 15px;
        margin-left: 8px;
        color: #e67e22;
        font-weight: 700;
      }
      .profile-details {
        margin: 24px 0 0 64px;
        font-size: 20px;
        color: #444;
        line-height: 1.7;
      }
      .profile-actions {
        margin: 24px 0 0 64px;
      }
      .profile-actions .submit-btn {
        width: auto;
        min-width: 180px;
        padding: 10px 28px;
        font-size: 16px;
        border-radius: 999px;
      }
      .profile-verify-form {
        margin: 32px 0 0 64px;
        background: #f9fcf8;
        border-radius: 12px;
        padding: 24px 24px 12px 24px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.03);
        max-width: 600px;
      }
      .profile-verify-form label {
        font-size: 15px;
        margin-bottom: 4px;
      }
      .profile-verify-form input,
      .profile-verify-form textarea {
        font-size: 18px;
        padding: 14px;
        margin-bottom: 16px;
        border-radius: 8px;
      }
      @media (max-width: 900px) {
        .main-content {
          margin-left: 0;
          margin-top: 70px;
          padding: 0;
        }
        .profile-header,
        .profile-details,
        .profile-actions,
        .profile-verify-form {
          margin-left: 4vw;
          margin-right: 4vw;
        }
        .container {
          max-width: 100vw;
        }
      }
    </style>
  </head>
  <body>
    <header>
      <div
        class="logo"
        style="cursor: pointer"
        onclick="window.location.href='../../Index.html'"
      >
        üç¥ FoodShare
      </div>
      <nav>
        <a href="Profile.html">Profile</a>
        <a href="#" class="sign-up-btn" onclick="signOut()">Sign Out</a>
      </nav>
    </header>
    <div class="flex">
      <!-- Sidebar -->
      <aside class="sidebar">
        <div class="logo">FoodShare</div>
        <nav>
          <a href="CharityDashboard.html">Dashboard</a>
          <a href="PostFoodNeed.html" id="sidebar-post-need">Post Food Need</a>
          <a href="#" id="sidebar-browse-donor">Browse Donor Offers</a>
          <a href="Requests.html">Requests</a>
          <!-- <a href="#">Beneficiaries</a> -->
          <a href="Profile.html" class="active">Profile</a>
        </nav>
      </aside>
      <!-- Main Content -->
      <div
        style="
          flex: 1;
          display: flex;
          flex-direction: column;
          min-height: 100vh;
        "
      >
        <main class="main-content">
          <div
            class="container"
            style="
              padding: 0;
              box-shadow: none;
              background: none;
              max-width: 700px;
            "
          >
            <div class="profile-header">
              <div class="profile-banner"></div>
              <img
                src="https://ui-avatars.com/api/?name=Charity+Org&background=54d12b&color=fff&size=128"
                id="profileAvatar"
                class="profile-avatar"
                alt="Avatar"
              />
              <div class="profile-info">
                <h2 id="charityName"></h2>
                <span id="verifyStatus"></span>
              </div>
            </div>
            <div class="profile-details" id="profileDetails"></div>
            <div class="profile-actions" id="profileActions">
              <div class="profile-action-buttons">
                <button class="edit-btn" type="button" onclick="showEditForm()">
                  <svg
                    class="icon"
                    viewBox="0 0 24 24"
                    width="20"
                    height="20"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M15.232 5.232l3.536 3.536M9 13l6-6m2 2l-6 6m-2 2h6"
                    />
                  </svg>
                  Edit Profile
                </button>
                <button
                  class="delete-btn"
                  type="button"
                  onclick="deleteAccount()"
                >
                  <svg
                    class="icon"
                    viewBox="0 0 24 24"
                    width="20"
                    height="20"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M6 18L18 6M6 6l12 12"
                    />
                  </svg>
                  Delete Account
                </button>
              </div>
              <form
                id="editForm"
                style="display: none; margin-top: 24px"
                class="profile-verify-form"
              >
                <label for="editName">Organization Name</label>
                <input type="text" id="editName" name="editName" required />
                <label for="editAddress">Address</label>
                <input
                  type="text"
                  id="editAddress"
                  name="editAddress"
                  required
                />
                <label for="editContact">Contact Phone/Email</label>
                <input
                  type="text"
                  id="editContact"
                  name="editContact"
                  required
                />
                <label for="editDesc">Description</label>
                <textarea id="editDesc" name="editDesc" required></textarea>
                <button type="submit" class="submit-btn">Save Changes</button>
              </form>
            </div>
            <div id="verifySection"></div>
            <style>
              .profile-action-buttons {
                display: flex;
                gap: 18px;
                margin-bottom: 10px;
              }
              .profile-action-buttons button {
                display: flex;
                align-items: center;
                gap: 7px;
                font-size: 16px;
                font-weight: bold;
                border: none;
                border-radius: 999px;
                padding: 10px 28px;
                cursor: pointer;
                transition: background 0.2s, color 0.2s;
              }
              .profile-action-buttons .edit-btn {
                background: #54d12b;
                color: #fff;
              }
              .profile-action-buttons .edit-btn:hover {
                background: #43a81a;
              }
              .profile-action-buttons .delete-btn {
                background: #e67e22;
                color: #fff;
              }
              .profile-action-buttons .delete-btn:hover {
                background: #cf7c1b;
              }
              .profile-action-buttons .icon {
                margin-right: 4px;
                vertical-align: middle;
              }
            </style>
            <script>
              // Prefill edit form with current data
              function showEditForm() {
                const jwt = getJWT() || {
                  name: localStorage.getItem("charityName") || "Charity Org",
                  address: "",
                  contact: "",
                  desc: "",
                };
                document.getElementById("editName").value = jwt.name || "";
                document.getElementById("editAddress").value =
                  jwt.address || "";
                document.getElementById("editContact").value =
                  jwt.contact || "";
                document.getElementById("editDesc").value = jwt.desc || "";
                document.getElementById("editForm").style.display = "block";
              }

              function deleteAccount() {
                if (
                  confirm(
                    "Are you sure you want to delete your account? This cannot be undone."
                  )
                ) {
                  // TODO: Call backend to delete, then clear localStorage
                  localStorage.removeItem("jwt");
                  localStorage.removeItem("charityName");
                  alert("Account deleted.");
                  window.location.href = "../Login.html";
                }
              }
            </script>
          </div>
          <a
            href="CharityDashboard.html"
            class="back-link"
            style="margin-left: 32px"
            >‚Üê Back to Dashboard</a
          >
          <script>
            // Sidebar actions for Post Need and Browse Donor Offers
            document.addEventListener("DOMContentLoaded", function () {
              var postNeed = document.getElementById("sidebar-post-need");
              if (postNeed)
                postNeed.onclick = function (e) {
                  e.preventDefault();
                  window.location.href = "PostFoodNeed.html";
                };
              var browseDonor = document.getElementById("sidebar-browse-donor");
              if (browseDonor)
                browseDonor.onclick = function (e) {
                  e.preventDefault();
                  window.location.href = "BrowseDonorOffers.html";
                };
            });
          </script>
        </main>
      </div>
    </div>
    <script>
      function signOut() {
        window.location.href = "../Login.html";
      }
      // Simulate JWT in localStorage: {token: ..., verified: true/false, name: ...}
      function getJWT() {
        let jwt = localStorage.getItem("jwt");
        if (!jwt) return null;
        try {
          return JSON.parse(jwt);
        } catch {
          return null;
        }
      }
      function setJWT(jwt) {
        localStorage.setItem("jwt", JSON.stringify(jwt));
      }
      // Display name and status
      const jwt = getJWT() || {
        name: localStorage.getItem("charityName") || "Charity Org",
        verified: false,
      };
      document.getElementById("charityName").textContent = jwt.name;
      document.getElementById(
        "profileAvatar"
      ).src = `https://ui-avatars.com/api/?name=${encodeURIComponent(
        jwt.name || "Charity Org"
      )}&background=54d12b&color=fff&size=128`;
      document.getElementById("verifyStatus").innerHTML = jwt.verified
        ? '<span class="verified">Verified</span>'
        : '<span class="not-verified">Not Verified</span>';
      // Profile details
      let details = "";
      if (jwt.address) details += `<div><b>Address:</b> ${jwt.address}</div>`;
      if (jwt.contact) details += `<div><b>Contact:</b> ${jwt.contact}</div>`;
      if (jwt.desc) details += `<div><b>Description:</b> ${jwt.desc}</div>`;
      document.getElementById("profileDetails").innerHTML = details;

      // Handle edit form submit
      document.addEventListener("submit", function (e) {
        if (e.target && e.target.id === "editForm") {
          e.preventDefault();
          const form = document.getElementById("editForm");
          const updated = {
            ...getJWT(),
            name: form.editName.value,
            address: form.editAddress.value,
            contact: form.editContact.value,
            desc: form.editDesc.value,
            verified: (getJWT() && getJWT().verified) || false,
          };
          setJWT(updated);
          alert("Profile updated!");
          window.location.reload();
        }
      });
      // Verification section
      const verifySection = document.getElementById("verifySection");
      if (!jwt.verified) {
        verifySection.innerHTML = `
        <div class="profile-actions"><button class="submit-btn" onclick="showVerifyForm()">Verify Account</button></div>
        <form id="verifyForm" class="profile-verify-form" style="display:none;" enctype="multipart/form-data">
          <label for="idUpload">Upload Tax Compliance Certificate</label>
          <input type="file" id="idUpload" name="idUpload" accept="image/*,.pdf" required />
          <label for="certUpload">Upload Certificate of Incorporation</label>
          <input type="file" id="certUpload" name="certUpload" accept="image/*,.pdf" required />
          <label for="address">Organization Address</label>
          <input type="text" id="address" name="address" required />
          <label for="contact">Contact Phone/Email</label>
          <input type="text" id="contact" name="contact" required />
          <label for="desc">Organization Description</label>
          <textarea id="desc" name="desc" required></textarea>
          <button type="submit" class="submit-btn">Submit Verification</button>
        </form>
      `;
      }
      function showVerifyForm() {
        document.getElementById("verifyForm").style.display = "block";
      }
      // Handle verification form
      document.addEventListener("submit", async function (e) {
        if (e.target && e.target.id === "verifyForm") {
          e.preventDefault();
          const form = document.getElementById("verifyForm");
          const formData = new FormData(form);
          formData.append("charityName", jwt.name);
          try {
            const response = await fetch(
              "https://foodshare-nairobi-1.onrender.com/api/verify-charity",
              {
                method: "POST",
                body: formData,
              }
            );
            if (response.ok) {
              alert(
                "Verification submitted! Your documents and info have been sent for review."
              );
              // Optionally update local status
              jwt.verified = false;
              jwt.address = form.address.value;
              jwt.contact = form.contact.value;
              jwt.desc = form.desc.value;
              setJWT(jwt);
              // Hide verify button and form after submission
              const actions = document.querySelector(".profile-actions");
              if (actions) actions.style.display = "none";
              form.style.display = "none";
              // Optionally, update status text
              document.getElementById("verifyStatus").innerHTML =
                '<span class="not-verified">Verification Pending</span>';
            } else {
              alert("Failed to submit verification. Please try again.");
            }
          } catch (err) {
            alert("Network error. Please try again.");
          }
        }
      });
    </script>
  </body>
</html>
